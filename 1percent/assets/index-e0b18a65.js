import{j as t,F as _,u as j,a as ge,B as O,b as k,c as ae,M as xe,S as be,T as ve,d as je,e as we,f as Pe,g as Y,h as b,i as Me,k as v,C as Ie,V as Fe,l as M,m as I,I as F,n as S,o as D,p as E,q as G,r as Se}from"./ui-7e819fc5.js";import{a as De,r as re}from"./react-25ef465b.js";import{u as Ee,a as Te,c as ie,b as L,d as Ce,e as ke,P as Le}from"./state-dc21e7a1.js";import{u as Ne}from"./forms-ba993d7c.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();var se,H=De;se=H.createRoot,H.hydrateRoot;const Re=({children:e})=>t.jsx(_,{direction:j({base:"column",md:"row"},{fallback:"md"}),flex:"1",padding:j({base:"0",md:"8"},{fallback:"md"}),width:"100vw",children:e}),Be=()=>{const{colorMode:e,toggleColorMode:n}=ge();return t.jsx(O,{background:k("green.600","gray.900"),paddingInline:"4",width:"100%",children:t.jsxs(_,{height:"16",alignItems:"center",justifyContent:"space-between",children:[t.jsx(O,{textColor:k("whiteAlpha.900","whiteAlpha.900"),fontWeight:"bold",children:"1Percent"}),t.jsx(ae,{onClick:n,"aria-label":"Change theme",children:e==="light"?t.jsx(xe,{}):t.jsx(be,{})})]})})},Oe=Ee,K=Te,le=()=>k("white","gray.900");function qe(e){return Array.from(Array(e))}function q(e,n,a){const s=n<10?`0${n}`:n,r=a<10?`0${a}`:a;return`${e}-${s}-${r}`}function T(e){const[n,a,s]=e.split("-");return[Number(n),Number(a),Number(s)]}function Ae(e,n,a=!0){const s=new Date(e),r=new Date(n);return(r.getFullYear()-s.getFullYear())*12-s.getMonth()+r.getMonth()+Number(a)}function R(e,n,a=!0){const s=new Date(e),r=new Date(n);return Math.floor((r.getTime()-s.getTime())/864e5)+Number(a)}function oe(e,n){const a=new Date(e);return a.setMonth(a.getMonth()+n),q(a.getFullYear(),a.getMonth()+1,a.getDate())}function _e(e){return e/1200}function ce(e,n){return Math.pow(e+1,n)}function We(e,n,a){const s=ce(e,n);return a*e/(1-1/s)}function Ve(e,n,a,s){const r=ce(e,n);return a*r-s*(r-1)/e}function ze(e,n,a,s){return a===1?n*e:Ve(e,a-1,n,s)*e}function $e(e,n){return e-n}const J="abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ0123456789";function ue(e=10){return qe(e).map(()=>J[Math.floor(Math.random()*J.length)]).join("")}function C(e){return Number(e.toFixed(2).replace(/^-0$/,"0"))}const Ye=({items:e})=>t.jsx(ve,{background:le(),flex:"1",padding:"4",rounded:"md",children:t.jsxs(je,{variant:"striped",colorScheme:"green",children:[e.length===0?t.jsx(we,{children:"Click 'Change' in the settings panel"}):null,t.jsx(Pe,{children:t.jsxs(Y,{children:[t.jsx(b,{children:"#"}),t.jsx(b,{children:"Early"}),t.jsx(b,{children:"Date"}),t.jsx(b,{isNumeric:!0,children:"Principal"}),t.jsx(b,{isNumeric:!0,children:"Interest"}),t.jsx(b,{isNumeric:!0,children:"Total"}),t.jsx(b,{isNumeric:!0,children:"Balance"})]})}),t.jsx(Me,{children:e.map((n,a)=>t.jsxs(Y,{children:[t.jsx(v,{children:a+1}),t.jsx(v,{children:n.isEarly?t.jsx(Ie,{}):null}),t.jsx(v,{children:n.date}),t.jsxs(v,{isNumeric:!0,children:[C(n.principal)," RON"]}),t.jsxs(v,{isNumeric:!0,children:[C(n.interest)," RON"]}),t.jsxs(v,{isNumeric:!0,children:[C(n.total)," RON"]}),t.jsxs(v,{isNumeric:!0,children:[C(n.balance)," RON"]})]},n.id))})]})}),Ge=({children:e})=>t.jsx(_,{bg:k("gray.100","gray.800"),direction:"column",align:"flex-start",minHeight:"100vh",width:"100vw",children:e}),He=({initialValues:e,onSettingsChange:n})=>{const a=y=>{const d={};return y.balance<=0&&(d.balance="Balance must be greater than 0"),y.interestRate<=0&&(d.interestRate="Interest rate must be greater than 0"),Date.parse(y.firstPayment)>=Date.parse(y.finalMaturity)&&(d.firstPayment="First payment must be before final maturity",d.finalMaturity="Final maturity must be after first payment"),d},{values:s,errors:r,handleChange:i,setFieldValue:c,setFieldTouched:f,handleSubmit:h}=Ne({initialValues:e,validateOnMount:!0,validate:a,onSubmit:n}),l=y=>{i(y);const[,,d]=T(y.target.value),m=T(s.finalMaturity);m[2]=d,c("finalMaturity",q(...m)),f("finalMaturity")},u=y=>{i(y);const[,,d]=T(y.target.value),m=T(s.firstPayment);m[2]=d,c("firstPayment",q(...m)),f("finalMaturity")};return t.jsx(O,{background:le(),height:"100%",padding:"4",marginRight:j({base:"0",md:"8"},{fallback:"md"}),marginBlock:j({base:"4",md:"0"},{fallback:"md"}),rounded:j({base:"0",md:"md"},{fallback:"md"}),children:t.jsx("form",{onSubmit:h,children:t.jsxs(Fe,{spacing:"4",align:"flex-start",children:[t.jsxs(M,{isInvalid:!!r.balance,children:[t.jsx(I,{htmlFor:"balance",children:"Balance"}),t.jsxs(F,{children:[t.jsx(S,{pointerEvents:"none",fontSize:"1.2em",children:"$"}),t.jsx(D,{id:"balance",name:"balance",type:"number",variant:"filled",required:!0,value:s.balance,onChange:i})]}),t.jsx(E,{children:r.balance})]}),t.jsxs(M,{isInvalid:!!r.interestRate,children:[t.jsx(I,{htmlFor:"interestRate",children:"Interest Rate"}),t.jsxs(F,{children:[t.jsx(S,{pointerEvents:"none",fontSize:"1.2em",children:"%"}),t.jsx(D,{id:"interestRate",name:"interestRate",type:"number",variant:"filled",required:!0,value:s.interestRate,onChange:i})]}),t.jsx(E,{children:r.interestRate})]}),t.jsxs(M,{isInvalid:!!r.firstPayment,children:[t.jsx(I,{htmlFor:"firstPayment",children:"First Payment"}),t.jsxs(F,{children:[t.jsx(S,{pointerEvents:"none",children:t.jsx(G,{})}),t.jsx(D,{id:"firstPayment",name:"firstPayment",type:"date",variant:"filled",required:!0,value:s.firstPayment,onChange:l})]}),t.jsx(E,{children:r.firstPayment})]}),t.jsxs(M,{isInvalid:!!r.finalMaturity,children:[t.jsx(I,{htmlFor:"finalMaturity",children:"Final Maturity"}),t.jsxs(F,{children:[t.jsx(S,{pointerEvents:"none",children:t.jsx(G,{})}),t.jsx(D,{id:"finalMaturity",name:"finalMaturity",type:"date",variant:"filled",required:!0,value:s.finalMaturity,onChange:u})]}),t.jsx(E,{children:r.finalMaturity})]}),t.jsx(ae,{type:"submit",colorScheme:"green",width:"full",children:"Change"})]})})})},Ke={data:[]},U=e=>{var l;const{balance:n,finalMaturity:a,firstPayment:s,interestRate:r}=e,i=_e(r),c=Ae(s,a),f=[],h=We(i,c,n);for(let u=0;u<c;u++){const y=oe(s,u),d=ze(i,n,u+1,h),m=$e(h,d),x=(((l=f[u-1])==null?void 0:l.balance)??n)-m;f.push({id:ue(),date:y,principal:m,interest:d,total:h,balance:x,expected:d,original:{principal:m,interest:d,total:h,balance:x},isEarly:!1,saved:0})}return f},de=ie({name:"items",initialState:Ke,reducers:{addEarlyPayment:(e,n)=>{const{date:a,value:s,type:r,summable:i,expected:c}=n.payload,f=new Date(a),{lastPayment:h,lastWholePayment:l,nextWholePayment:u,nextWholePaymentIndex:y,savedTotal:d}=e.data.reduce((o,g,P)=>(new Date(g.date)<f?(o.savedTotal+=g.saved,o.lastPayment=g,o.lastPaymentIndex=P,g.isEarly||(o.lastWholePayment=g,o.lastWholePaymentIndex=P)):(o.nextPayment=o.nextPayment??g,o.nextPaymentIndex=o.nextPaymentIndex??P,g.isEarly||(o.nextWholePayment=o.nextWholePayment??g,o.nextWholePaymentIndex=o.nextWholePaymentIndex??P)),o),{savedTotal:0}),m=Math.min(h.balance,s+d),x=h.balance-m,W=e.data[e.data.length-1],he=r==="loan"?W.date:oe(W.date,-1*Math.floor(m/u.original.principal)),ye=R(l.date,u.date,!0),pe=R(h.date,a,!0),w=u.original.interest/30*(pe-(ye-30)),V=m+w;let N=[],z=0;if(x>0){console.log(a,u.date),N=U({balance:x,firstPayment:u.date,finalMaturity:he,interestRate:5.8});const o=N[0];console.log(a,o),o.interest=o.original.interest/30*R(a,o.date,!0),o.total=o.original.total-(w-o.interest),o.principal=o.total-o.interest,i&&(z=u.original.total-o.original.total)}const $=[...e.data];$.splice(y),e.data=[...$,{id:ue(),date:a,principal:m,interest:w,total:V,balance:x,original:{principal:m,interest:w,total:V,balance:x},isEarly:!0,saved:z,expected:c},...N]},generateItems:(e,n)=>{e.data=U(n.payload)}}}),{addEarlyPayment:p,generateItems:Je}=de.actions,Ue=e=>e.items.data,Xe={balance:588e3,finalMaturity:"2035-12-20",firstPayment:"2021-01-20",interestRate:5.8},fe=ie({name:"settings",initialState:Xe,reducers:{setSettings:(e,n)=>{e.balance=n.payload.balance,e.finalMaturity=n.payload.finalMaturity,e.firstPayment=n.payload.firstPayment,e.interestRate=n.payload.interestRate}}}),{setSettings:Ze}=fe.actions,Qe=e=>e.settings;globalThis&&globalThis.__generator;globalThis&&globalThis.__spreadArray;var A;(function(e){e.uninitialized="uninitialized",e.pending="pending",e.fulfilled="fulfilled",e.rejected="rejected"})(A||(A={}));var X=L("__rtkq/focused"),Z=L("__rtkq/unfocused"),Q=L("__rtkq/online"),ee=L("__rtkq/offline"),B=!1;function et(e,n){function a(){var s=function(){return e(X())},r=function(){return e(Z())},i=function(){return e(Q())},c=function(){return e(ee())},f=function(){window.document.visibilityState==="visible"?s():r()};B||typeof window<"u"&&window.addEventListener&&(window.addEventListener("visibilitychange",f,!1),window.addEventListener("focus",s,!1),window.addEventListener("online",i,!1),window.addEventListener("offline",c,!1),B=!0);var h=function(){window.removeEventListener("focus",s),window.removeEventListener("visibilitychange",f),window.removeEventListener("online",i),window.removeEventListener("offline",c),B=!1};return h}return n?n(e,{onFocus:X,onFocusLost:Z,onOffline:ee,onOnline:Q}):a()}var te;(function(e){e.query="query",e.mutation="mutation"})(te||(te={}));A.uninitialized;var ne;typeof queueMicrotask=="function"&&queueMicrotask.bind(typeof window<"u"?window:typeof global<"u"?global:globalThis);const me=Ce({reducer:ke({items:de.reducer,settings:fe.reducer})});et(me.dispatch);const tt=()=>{const e=Oe(),n=K(Qe),a=K(Ue),s=r=>{e(Ze(r)),e(Je(r)),e(p({type:"period",value:4330.7,date:"2022-03-03",summable:!1,expected:1169.3})),e(p({type:"period",value:3399.92,date:"2022-04-08",summable:!1,expected:1600.08})),e(p({type:"period",value:3680.18,date:"2022-05-05",summable:!1,expected:1319.82})),e(p({type:"period",value:7913.33,date:"2022-06-21",summable:!1,expected:86.67})),e(p({type:"period",value:7914.97,date:"2022-07-21",summable:!1,expected:85.03})),e(p({type:"period",value:9833.24,date:"2022-08-22",summable:!1,expected:166.76})),e(p({type:"period",value:9918.59,date:"2022-09-21",summable:!1,expected:81.41})),e(p({type:"period",value:15032.58,date:"2022-10-05",summable:!1,expected:1117.42})),e(p({type:"period",value:10011.07,date:"2022-10-27",summable:!1,expected:538.93})),e(p({type:"period",value:12500.49,date:"2022-12-05",summable:!1,expected:1124.51})),e(p({type:"period",value:15000.03,date:"2023-01-03",summable:!1,expected:942.97})),e(p({type:"period",value:15e3,date:"2023-01-31",summable:!1,expected:766.61})),e(p({type:"loan",value:15e3,date:"2023-03-06",summable:!0,expected:1069.38}))};return re.useEffect(()=>{s(n)},[]),t.jsxs(Ge,{children:[t.jsx(Be,{}),t.jsxs(Re,{children:[t.jsx(He,{initialValues:n,onSettingsChange:s}),t.jsx(Ye,{items:a})]})]})},nt=document.getElementById("root");se(nt).render(t.jsx(re.StrictMode,{children:t.jsx(Le,{store:me,children:t.jsx(Se,{children:t.jsx(tt,{})})})}));
